<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Attenza - Setup Step 1</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />

    <style>
        :root {
            --bg-body: #F9F8F6;
            --bg-white: #ffffff;
            --text-main: #18181b;
            --text-muted: #71717a;
            --text-light: #9ca3af;
            --brand-purple: #6E62E5;
            --brand-purple-light: rgba(110, 98, 229, 0.08);
            --border-color: #f3f4f6;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --radius-xl: 16px;
            --radius-lg: 12px;
            --radius-pill: 100px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-body); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; }
        button, input { border: none; outline: none; background: none; }
        
        .fade-in { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .scale-pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.95); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* --- LAYOUT CONTAINERS --- */
        .container-main { 
            flex: 1; 
            /* Reduced top padding */
            padding-top: 12px; 
            padding-bottom: 120px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .px-default { padding-left: 20px; padding-right: 20px; }
        .px-grid { padding-left: 12px; padding-right: 8px; }

        /* --- HEADER & NAV --- */
        /* Reduced margin-bottom from 24px to 12px */
        .nav-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .nav-btn {
            width: 40px; height: 40px; border-radius: 30%; background: var(--bg-white);
            border: 1px solid var(--border-color); color: var(--text-main);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: background 0.2s; box-shadow: var(--shadow-sm);
        }

        /* Reduced margin-bottom from 32px to 16px */
        .progress-wrapper { margin-bottom: 26px; }
        .step-text { font-size: 11px; font-weight: 700; color: var(--brand-purple); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }
        .progress-track { width: 100%; height: 6px; background: #E4E4E7; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; width: 33%; background: var(--brand-purple); border-radius: 10px; }

        /* --- PROFILE --- */
        /* Reduced margin-bottom from 32px to 20px */
        .profile-card { display: flex; gap: 16px; margin-bottom: 26px; align-items: flex-start; }
        .profile-img { width: 60px; height: 60px; border-radius: var(--radius-xl); object-fit: cover; border: 1px solid white; box-shadow: var(--shadow-sm); flex-shrink: 0; }
        .profile-info { height: 60px; display: flex; flex-direction: column; justify-content: space-between; padding: 1px 0; width: 100%; overflow: hidden; position: relative; }
        .profile-name { font-size: 17px; font-weight: 700; line-height: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 20px; }
        .profile-email { font-size: 12px; font-weight: 500; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .profile-pills { display: flex; gap: 8px; align-items: center; }
        .pill { padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .pill-purple { background: rgba(110, 98, 229, 0.1); border: 1px solid rgba(110, 98, 229, 0.1); color: var(--brand-purple); }
        .edit-icon { position: absolute; bottom: 4px; right: 0; width: 22px; height: 22px; cursor: pointer; color: #18181b; }

        /* Reduced margin-bottom from 20px to 12px */
        .context-header { margin-bottom: 16px; }
        .context-title { font-size: 20px; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 4px; color: var(--text-main); }
        .context-sub { font-size: 14px; color: var(--text-muted); line-height: 1.4; }

        /* --- SEARCH (Improved Seamless Logic) --- */
        /* Reduced margin-bottom from 32px to 16px and removed top padding */
        .search-container { position: relative; width: 100%; margin-bottom: 26px; padding-top: 0px; }
        
        .search-icon {
            position: absolute; left: 20px; top: 50%; transform: translateY(-50%);
            color: #18181b; font-size: 24px; pointer-events: none; z-index: 5; transition: color 0.3s;
        }

        /* This layer sits behind the input */
        .fake-placeholder-layer {
            position: absolute;
            left: 56px; /* Matches input padding-left precisely */
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            display: flex;
            align-items: center;
            font-size: 16px;
            font-weight: 500;
            color: #D4D4D8;
            z-index: 1;
        }

        .blinking-cursor {
            color: var(--text-main); /* Theme Black */
            font-weight: 300;
            margin-right: -1.5px; /* Forced overlap with the letter T */
            animation: cursorBlink 1s step-end infinite;
        }
        @keyframes cursorBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        .search-input {
            position: relative;
            z-index: 2; /* Sits on top of fake placeholder */
            width: 100%; 
            background-color: transparent;
            /* Slightly tighter padding */
            padding: 10px 12px 10px 38px; 
            font-size: 16px; font-weight: 500; color: var(--text-main);
            border-bottom: 2px solid #18181b; border-radius: 0;
            transition: border-color 0.3s ease;
        }

        .search-input:focus { border-bottom-color: var(--brand-purple); }
        .search-input:focus ~ .search-icon { color: var(--brand-purple); }

        /* SEAMLESS HIDE: Hide fake text on focus OR when not empty */
        .search-input:focus + .fake-placeholder-layer,
        .search-input:not(:placeholder-shown) + .fake-placeholder-layer {
            opacity: 0;
            visibility: hidden;
        }

        /* --- PILL GRID --- */
        .pill-grid { display: flex; flex-wrap: wrap; gap: 8px; align-content: flex-start; width: 100%; }
        .subject-pill {
            display: inline-flex; align-items: center; gap: 8px;
            /* Tighter internal padding */
            padding: 9px 11px; 
            background: var(--bg-white); border: 1px solid #e4e4e7;
            border-radius: var(--radius-pill); cursor: pointer;
            transition: all 0.2s ease; user-select: none;
        }
        .pill-text { font-size: 13px; font-weight: 600; color: var(--text-main); }
        .pill-icon { font-size: 16px; color: var(--text-light); }
        .subject-pill.active { background: var(--brand-purple-light); border-color: var(--brand-purple); }
        .subject-pill.active .pill-text, .subject-pill.active .pill-icon { color: var(--brand-purple); }
        .subject-pill.create-mode { border: 1px dashed var(--text-muted); background: transparent; }

        /* Missing Subject Footer */
        .missing-footer {
            width: 100%; text-align: center; margin-top: 20px;
            color: var(--text-light); font-size: 13px; font-weight: 500;
        }

        /* --- ACTION BAR --- */
        .action-bar-container {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%) translateY(100px);
            z-index: 100; opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none; width: auto;
        }
        .action-bar-container.visible { transform: translateX(-50%) translateY(0); opacity: 1; pointer-events: auto; }
        .action-bar {
            background-color: #0F0F11; color: white; padding: 5px 5px 5px 20px;
            border-radius: 100px; display: flex; align-items: center; gap: 20px;
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.3); min-width: 260px; justify-content: space-between;
        }
        .btn-continue-pill {
            background-color: #ffffff; color: #0F0F11; border: none; padding: 10px 20px;
            border-radius: 100px; font-size: 13px; font-weight: 700; cursor: pointer;
        }
        .selection-count { font-size: 14px; }
    </style>
</head>

<body>

    <div class="container-main fade-in">
        
        <div class="nav-header px-default">
            <button class="nav-btn" onclick="window.history.back()">
                <span class="material-symbols-rounded">arrow_back</span>
            </button>
            <button class="nav-btn">
                <span class="material-symbols-rounded" style="color: var(--brand-purple);">help</span>
            </button>
        </div>

        <div class="progress-wrapper px-default">
            <div class="step-text">Step 1 of 3</div>
            <div class="progress-track"><div class="progress-fill"></div></div>
        </div>

        <div class="profile-card px-default">
            <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" class="profile-img">
            <div class="profile-info">
                <h2 class="profile-name">Johnathan Doe</h2>
                <p class="profile-email">john.doe23@university.edu</p>
                <div class="profile-pills">
                    <span class="pill pill-purple">Roll - 234</span>
                    <span class="pill pill-purple">B.Com 1st Sem</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="edit-icon"><path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg> 
            </div>
        </div>

        <div class="context-header px-default">
            <h1 class="context-title">Choose your subjects</h1>
            <p class="context-sub">Select or create the subjects for your current class session</p>
        </div>

        <div class="search-container px-default">
            <input type="text" id="subjectInput" placeholder=" " class="search-input" oninput="handleSearch()">
            
            <div class="fake-placeholder-layer">
                <span class="blinking-cursor">|</span>Type subject name to create
            </div>
            
            <span class="material-symbols-rounded search-icon">search</span>
        </div>

        <div id="gridContainer" class="pill-grid px-grid"></div>

        <div class="missing-footer">Missing subject? Create to add</div>

    </div>

    <div id="actionBar" class="action-bar-container">
        <div class="action-bar">
            <span class="selection-count" id="countText">0 selected</span>
            <button class="btn-continue-pill" onclick="alert('Proceed to Step 2')">Continue</button>
        </div>
    </div>

    <script>
        const fetchedSubjects = [
            "Financial Accounting", "Business Law", "Micro Economics", 
            "Communicative English", "Business Stats", "Cost Accounting", 
            "Marketing Management", "Corporate Law", "Indian Economy", 
            "IT in Business", "Entrepreneurship", "Auditing"
        ];

        let selectedSubjects = new Set();
        let customSubjects = new Set();
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        ctx.font = "600 13px Inter, sans-serif"; // Updated to match new font size

        const grid = document.getElementById('gridContainer');
        const input = document.getElementById('subjectInput');
        const actionBar = document.getElementById('actionBar');
        const countText = document.getElementById('countText');

        setTimeout(() => renderGrid(), 50);
        new ResizeObserver(() => renderGrid(input.value)).observe(grid);

        function handleSearch() { renderGrid(input.value); }

        function renderGrid(query = "") {
            const containerWidth = grid.getBoundingClientRect().width;
            if(containerWidth < 50) return; 

            grid.innerHTML = "";
            const q = query.toLowerCase().trim();
            let allSubjects = new Set([...fetchedSubjects, ...customSubjects]);
            let filteredList = Array.from(allSubjects).filter(sub => sub.toLowerCase().includes(q));

            let allItems = filteredList.map(name => ({
                name, width: ctx.measureText(name).width + 50, isSelected: selectedSubjects.has(name)
            }));

            let selectedItems = allItems.filter(item => item.isSelected).sort(() => Math.random() - 0.5);
            let unselectedItems = allItems.filter(item => !item.isSelected).sort(() => Math.random() - 0.5);
            let finalPool = [...selectedItems, ...unselectedItems];

            const organizedItems = packItemsDense(finalPool, containerWidth);
            organizedItems.forEach(item => grid.appendChild(createPill(item.name, false)));

            if (q.length > 0 && !filteredList.some(sub => sub.toLowerCase() === q)) {
                grid.appendChild(createPill(input.value.trim(), true));
            }
        }

        function packItemsDense(items, containerWidth) {
            let packedRows = [];
            let pool = [...items]; 
            const GAP = 8;
            const availableSpace = containerWidth - 16; 

            while (pool.length > 0) {
                let row = [];
                let firstItem = pool.shift(); 
                row.push(firstItem);
                let remainingSpace = availableSpace - firstItem.width;
                while (remainingSpace > 0 && pool.length > 0) {
                    let bestMatchIndex = -1;
                    let bestMatchSize = 0;
                    for (let i = 0; i < pool.length; i++) {
                        let totalW = pool[i].width + GAP; 
                        if (totalW <= remainingSpace && totalW > bestMatchSize) {
                            bestMatchSize = totalW; bestMatchIndex = i;
                        }
                    }
                    if (bestMatchIndex !== -1) {
                        let matched = pool.splice(bestMatchIndex, 1)[0];
                        row.push(matched);
                        remainingSpace -= (matched.width + GAP);
                    } else break;
                }
                packedRows.push(row);
            }
            return packedRows.flat();
        }

        function createPill(name, isCreationMode) {
            const el = document.createElement('div');
            el.className = `subject-pill scale-pop ${selectedSubjects.has(name) ? 'active' : ''} ${isCreationMode ? 'create-mode' : ''}`;
            el.innerHTML = `<span class="pill-text">${isCreationMode ? 'Create "'+name+'"' : name}</span>
                            <span class="material-symbols-rounded pill-icon">${selectedSubjects.has(name) ? 'check' : 'add'}</span>`;
            
            el.onclick = () => {
                if (isCreationMode) {
                    customSubjects.add(name); selectedSubjects.add(name); input.value = ""; 
                } else {
                    selectedSubjects.has(name) ? selectedSubjects.delete(name) : selectedSubjects.add(name);
                }
                handleSearch(); updateActionBar();
            };
            return el;
        }

        function updateActionBar() {
            const count = selectedSubjects.size;
            countText.innerText = `${count} selected`;
            actionBar.classList.toggle('visible', count > 0);
        }
    </script>
</body>
</html>
